<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>slackrepo - Usage notes</title>
<link rel="icon" type="image/png" href="/slackrepo/favicon.png">
<link rel="shortcut icon" href="/slackrepo/favicon.ico">
<link rel="stylesheet" type="text/css" href="/slackrepo/slackrepostyle.css">
</head>

<body>

<header>
<h2>Usage notes</h2>
<p><a href="#dependencies">Dependencies</a> &bull; <a href="#git">git</a> &bull; <a href="#updates">Updates</a>
&bull; <a href="#genrepos">gen_repos_files.sh</a> &bull; <a href="#slackpkgplus">slackpkg+</a></p>
</header>

<nav>
<h2><a href="index.html">slackrepo</a></h2>
<ul>
<li><a href="news.html">News</a></li>
<li><a href="download.html">Download</a></li>
<li><a href="quickstart.html">Quick start</a></li>
<li><a href="screenshots.html">Screenshots</a></li>
<li><a href="usagenotes.html">Documentation&nbsp;&raquo;</a></li>
<li>
  <ul>
  <li><b style="color:red">&bull;</b>&nbsp;<a href="usagenotes.html">Usage notes</a></li>
  <li><a href="hintfiles.html">Hintfiles</a></li>
  <li><a href="faq.html">FAQ</a></li>
  <li><a href="configuration.html">Configuration</a></li>
  <li><a href="structure.html">Repo structure</a></li>
  <li><a href="tests.html">Tests</a></li>
  <li><a href="links.html">Links</a></li>
  </ul>
</li>
<li><a href="slackrepo.8.html">manpages&nbsp;&raquo;</a></li>
</ul>
</nav>

<div id="main">

<h3><a name="dependencies"></a>Dependencies</h3>

<p>Dependencies are built, installed and removed automatically, according to the
contents of .info files (<code>REQUIRES="..."</code>) and
<a href="hintfiles.html">Hintfiles</a> (<code>ADDREQUIRES="..."</code>).
If a SlackBuild does not have a corresponding .info file or hintfile, dependencies cannot
be processed.</p>

<p>Except when --install is specified, building, installing and removing is done
as a 'tree' of dependencies, not a linear 'queue', so dependencies may be
installed and removed multiple times as necessary. This produces clean packages
that can be redistributed.</p>

<p>When an existing package in the repository is older than its dependencies,
it may need to be rebuilt. To cause a rebuild, the dependencies must have been
significantly updated: see <a href="#updates">Updates</a> below for details.</p>

<p>Remember that dependencies on standard Slackware packages are not listed
in .info files and hintfiles, and not tracked by slackrepo.</p>

<h3><a name="git"></a>git</h3>

<p>If no SlackBuild repository exists when slackrepo starts, it will clone the
SlackBuilds.org git repository, and a local branch <b>14.1</b> will be created
that tracks <b>origin/14.1</b> (i.e., the stable branch at SlackBuilds.org).</p>

<p>Otherwise, slackrepo simply uses the git branch and revision that is currently
checked out. If an item's SlackBuild directory is dirty, a warning is logged.</p>

<p>As a special case, if the local branch is named <b>14.1</b> (as above) and is
clean, then when slackrepo starts, it will automatically fast forward the local
branch from upstream (if possible), but <strong>only if more than
one day has elapsed</strong> since the last automatic fast forward.</p>

<h3><a name="updates"></a>Updates</h3>

<p>The build and rebuild commands will always update or rebuild packages if necessary.
For example, if a package is being built, its dependencies will be
updated and/or rebuilt if they are out-of-date. The update command proactively looks for
packages that are out-of-date, and removes packages for which the SlackBuilds
no longer exist.</p>

<p>A package is out-of-date if:</p>
<ul>
<li>the git revision in the directory containing the SlackBuild has changed
since the package was built</li>
<li>or the directory containing the SlackBuilds has untracked/uncommited files
(i.e., git is "dirty") and they are newer than the package</li>
<li>or its hintfile has changed since the package was built</li>
<li>or any of its direct dependencies has been updated since the package was built</li>
<li>or the version of Slackware has changed since the package was built</li>
</ul>

<p>Changes in the SlackBuilds directory are classified as 'updates', which will
cause directly depending items to be rebuilt if/when they are processed.
Other changes are classified as 'rebuilds' and do not cause
depending items to be rebuilt.</p>

<p>For example, ffmpeg depends on x264, and transcode depends on ffmpeg.
If x264 is updated, ffmpeg will be rebuilt, but transcode will not be rebuilt.
If x264 is rebuilt, ffmpeg will not be rebuilt.  If ffmpeg is updated,
transcode will be rebuilt.</p>

<p>Changes in the SlackBuilds directory that affect only the slack-desc file,
README file, and .info file (except for VERSION=) are ignored.</p>

<p>If a package is rebuilt, or if a package is updated but its
version number is unchanged, then <strong>the package's BUILD number
is always incremented</strong>, overriding the BUILD number in the SlackBuild file.</p>

<img src="screenrebuild.png" alt="screenshot of updated dependency and rebuild" title="updated dependency and rebuild">

<h3><a name="genrepos"></a>gen_repos_files.sh</h3>

<p>Optionally, Eric Hameleers'
<a href="http://www.slackware.com/~alien/tools/gen_repos_files.sh" class="ext">gen_repos_files.sh</a>
(which is included) can
be used to maintain additional package metadata in the package repository,
such as package signing and a changelog.  Thanks, Eric!  To use it, you will
need to set a few configuration values in the repository's configuration
file <code>/etc/slackrepo/slackrepo_SBo.conf</code> (but, if you use gen_repos_files.sh
already, your existing <code>~/.genreprc</code> config file will be read).</p>

<p>Note that you will be prompted for your GPG passphrase when gen_repos_files.sh
runs (after all the packages have been built).  You can avoid this by using
gpg-agent &mdash; see <a href="slackrepo.conf.5.html">slackrepo.conf(5)</a> for details.</p>

<h3><a name="slackpkgplus"></a>slackpkg+</h3>

<p>The repositories created by slackrepo and gen_repos_files.sh are suitable for use with Matteo Rossini's
<a href="http://slakfinder.org/slackpkg+.html" class="ext">slackpkg+</a>, which is a plugin for slackpkg
that allows you to use slackpkg to manage packages from third party
repositories.  Thanks, Matteo!</p>

<p>To make your slackrepo package repository accessible outside the build host, you will need to
export it as a shared directory (e.g. NFS or a Virtualbox shared folder),
or perhaps serve it via a local webserver on the build host (e.g. by
setting <code>PKGREPO=/var/www/htdocs/pkgrepo</code> in <code>/etc/slackrepo/slackrepo_SBo.conf</code>).</p>

<p>For example, on a client system, to configure slackpkg+ to use a shared
directory, you can define a slackpkgplus "local mirror" with <code>file://</code>
<i>(do not use <code>dir://</code>)</i>, and so <code>/etc/slackpkg/slackpkgplus.conf</code> would have something like this:</p>

<pre>
REPOPLUS=( SBo slackpkgplus restricted alienbob )
MIRRORPLUS['SBo']=file://sharedfolder/
</pre>

<p>Or to configure slackpkg+ to use a web-served repository on the build
host, you would have something like this:</p>

<pre>
REPOPLUS=( SBo slackpkgplus restricted alienbob )
MIRRORPLUS['SBo']=http://buildhost/pkgrepo/
</pre>

<p>If you choose not to sign your packages with gen_repos_files.sh, you will
need to tell slackpkg+ not to check GPG signatures.  There are two ways
of doing this: (1) set <code>CHECKGPG=off</code> in <code>/etc/slackpkg/slackpkg.conf</code>, or
(2) use the slackpkg control argument <code>-checkgpg=off</code>.</p>

<p>Note that slackpkg+ will not install newly added packages from your own
package repository when you run <code>slackpkg install-new</code>.  This command
searches for new packages ONLY in the official Slackware repository.  To
install specific packages in your own repository you can use</p>

<pre>
slackpkg install &lt;packagename...&gt;
</pre>

<p>or to install and upgrade everything in your own repository, you can use</p>

<pre>
slackpkg add &lt;reponame&gt;
</pre>
</div>

</body>
</html>
